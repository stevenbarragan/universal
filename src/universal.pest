WHITESPACE = _{ " " | "\t" | "\r" }

NEWLINE = _{ "\n" | ";" }

language = _{ NEWLINE* ~ (module | symbol | infix | integer | conditional | function_call | function_def | variable_def | variable) }

conditional = { conditional_type ~ instruction ~ block ~ else_block? ~ "end" }
conditional_type = { "if" | "unless" }
else_block = _{ "else" ~ block }

module = { "module" ~ name ~ block ~ "end" }

integer = @{ NUMBER+ }

function_call = { name ~ "(" ~ function_params ~ ")" }
function_params = { right ~ ("," ~ right)* }

instruction  = _{ infix | integer | function_call | variable }

right = _{ infix | integer | variable }
left = _{ variable_def | variable | integer }
infix = { left ~ message ~ right }
message = { "*" | "/" | "+" | "-" | "=" }

function_def = { "fn" ~ name ~ ("(" ~ params? ~ ")")? ~ ":" ~ results ~ block ~ "end" }

block = { (NEWLINE* ~ language)+ ~ NEWLINE* }

results = { kind ~ ("," ~ kind)* }
params = { param ~ ("," ~ param)* }
param = { variable ~ ":" ~ kind }

variable_def = { variable ~ ":" ~ kind }
variable = { !reserve_word ~ name }
kind = { name }

name = @{ LETTER ~ (LETTER | NUMBER)* }

symbol = { ":" ~ (symbol_value | "\"" ~ string_value ~ "\"") }
symbol_value = @{ (LETTER | NUMBER)+ }
string_value = { (LETTER | NUMBER)* }

reserve_word = _{ "end" | "fn" | "module" | "if" | "else" | "unless" }
